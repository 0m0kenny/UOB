---
title: "MSc Bioinformatics Coursework 2024/25"
author: "Kehinde Oyesola"
date: "02/11/2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#set up the environment, load packages and data needed for coursework
library(ggplot2)
library(tidyverse)
options(bitmapType='cairo')
rm(list=ls())
load("assess_data_1224.Rdata")
```

# 1 Simulate Markov Chains

## Q1 Comment Code

```{r}
#Defining parameters
set.seed(42) #set seed to allow any randomly generated data to be reproducible
a <- 0.8999 # the probability of going from state 1 to state 1
b <- 0.69 # the probability of going from state 2 to state 2
n_days <- 700 #number of days to simulate

#creates a 3x3 matrix of the transition probabilties 
transition_matrix <- matrix(c(a, 0.1, 0.0001,
                              0.3, b, 0.01,
                              0, 0, 1), nrow=3, ncol=3, byrow=TRUE)

state <- 1 #the initial state to start from i.e state 1
patient_record <- rep(0, n_days) #vector to store the simulated values over 700days

#for loop to iterate 700 times
for (day in 1:n_days) { 
  pr <- transition_matrix[state, ] # gets the probabilities in the row of the matrix according to the value of state
  
  state <- sample(c(1:3), size = 1, prob = pr) #sample from numbers 1-3 based on the probabilities (pr) and update the state with the value chosen
  patient_record[day] <- state #for each iteration, store the sampled state into the corresponding index position in the vector
}

plot(1:n_days, patient_record, "l") #display the simulated patient record over the 700 days on a line plot
```

## Q2 Extend the Markov Chain

```{r}
#Defining parameters
set.seed(42) #set seed to allow any randomly generated data to be reproducible
a <- 0.8999 # the probability of going from state 1 to state 1
b <- 0.29 # the probability of going from state 2 to state 2
c <- 0.55 # the probability of going from state 3 to state 3

n_days <- 700 #number of days to simulate

#creates a 4x4 matrix of the transition probabilties 
transition_matrix <- matrix(c(a, 0.1, 0, 0.0001,
                              0.3, b, 0.4, 0.01,
                              0.2, 0.2, c, 0.05, 0, 0, 0, 1), 
                            nrow=4, ncol=4, byrow=TRUE)

state <-  #the initial state to start from i.e state 1
patient_record <- rep(0, n_days) #vector to store the simulated values over 700days
patient_record
#for loop to iterate 700 times
for (day in 1:n_days) { 
  pr <- transition_matrix[state, ] # gets the probabilities in the row of the matrix according to the state
  
  state <- sample(c(1:4), size = 1, prob = pr) #sample from numbers 1-3 based on the probabilities (pr) and update the state with the sample
  patient_record[day] <- state #for each iteration, store the sampled state into the corresponding index position in the vector
}

plot(1:n_days, patient_record, "l") #display the simulated patient record over the 700 days on a line plot
```

### Analysis of Q2 results

There is no transition from state 4 (dead) to the other states except to state 4 because the probability of transitioning from state 4 to other states is 0, whereas transition from state 4 to state 4 has a probability of 1. Therefore, from day 23 where state 4 was first sampled, it will remain so indefinitely for the rest of the simulated days.

## Q3 Repeat the Simulation

Repeat the simulation for the four-state Markov Chain above for 1000 patients, by extending your code from the previous question or otherwise. Choose an appropriate plot to display how long a patient spends in each state, on average. Also, calculate the average time spent in each state for the 1000 patients. Explain the results and what the selected plot shows.




